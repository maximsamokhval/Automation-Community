
- [Собрать данные](#собрать-данные)
  - [Настройка технологического журнала на сбор данных](#настройка-технологического-журнала-на-сбор-данных)
    - [События для сбора](#события-для-сбора)
- [Получить имена таблиц](#получить-имена-таблиц)
- [Найти план запросов из кеша по тексту запросов](#найти-план-запросов-из-кеша-по-тексту-запросов)
- [Проверить актуальность статистики](#проверить-актуальность-статистики)
- [Получить граф взаимоблокировки](#получить-граф-взаимоблокировки)

## Собрать данные

### Настройка технологического журнала на сбор данных

#### События для сбора

**EXCP** - Для события EXCP достаточно установить только фильтр по имени базы, по этому событию мало пишется данных в технологический журнал.

**DBMSSQL** - Пишет очень много данных, поэтому здесь необходимо либо установить фильтры, либо разбирать огромный файл в поисках необходимой информации. Обязательно должны писаться все события DBMSSQL с отбором по свойству lkp=1 (необходимо для получения информации о жертве конфликта блокировок на уровне СУБД). Если же захочется найти источника блокировки, тогда, необходимо будет писать хотя бы все запросы с отбором по таблице на которой происходит конфликт.

Поскольку для анализа проблемы используется отдельная база, включить события EXCP и DBMSSQL с отбором по имени базы данных. ( свойство 
``` xml 
<like property="p:processName" value="MyDatabase%"/>
```
)

## Получить имена таблиц 

Использовать СтруктураХраненийБазыДанных() для определения объектов метаданных. 

## Найти план запросов из кеша по тексту запросов

[Способ получения плана запроса](../Методы%20получения%20плана%20запроса%20MSSQL.md)

## Проверить актуальность статистики

Сравнить ожидаемое и фактическое количество запрашиваемых и получаемых данных

## Получить граф взаимоблокировки

